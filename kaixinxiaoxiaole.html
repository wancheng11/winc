<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>å¼€å¿ƒæ¶ˆæ¶ˆä¹</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-touch-callout: none;
            touch-action: pan-y pinch-zoom;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            width: 100%;
            position: fixed;
            height: 100%;
        }

        .game-wrapper {
            width: 100%;
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            padding-top: 15px;
        }

        .score-panel {
            display: flex;
            justify-content: space-between;
            padding: 15px 20px;
            background: #fff;
            margin: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 400px;
        }

        .score-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 60px;
        }

        .score-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .score-label .material-icons {
            font-size: 14px;
            color: #FF6B6B;
        }

        .score-value {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            text-align: center;
        }

        .target-score {
            display: none;
        }

        .time-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 60px;
        }

        .time-item .material-icons {
            font-size: 14px;
            color: #FF6B6B;
            margin-bottom: 4px;
        }

        .time-value {
            font-size: 20px;
            font-weight: 600;
            color: #FF6B6B;
            text-align: center;
        }

        .game-container {
            width: 90%;
            max-width: 400px;
            aspect-ratio: 1;
            background: #fff;
            border-radius: 12px;
            padding: 10px;
            margin: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            gap: 2px;
            width: 100%;
            height: 100%;
        }

        .candy {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            background: rgba(255, 255, 255, 0.1);
        }

        .candy:active {
            transform: scale(0.9);
        }

        .candy.selected {
            transform: scale(1.15);
            z-index: 2;
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.6);
            animation: pulse 1s infinite;
        }

        .candy.matched {
            animation: pop 0.3s ease-out;
        }

        .candy.hint {
            animation: hintPulse 1s infinite;
        }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(0); }
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 15px rgba(255, 107, 107, 0.6);
                background: rgba(255, 107, 107, 0.2);
            }
            50% {
                box-shadow: 0 0 25px rgba(255, 107, 107, 0.8);
                background: rgba(255, 107, 107, 0.3);
            }
            100% {
                box-shadow: 0 0 15px rgba(255, 107, 107, 0.6);
                background: rgba(255, 107, 107, 0.2);
            }
        }

        @keyframes hintPulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
                background: rgba(255, 215, 0, 0.2);
            }
            50% {
                transform: scale(1.1);
                box-shadow: 0 0 25px rgba(255, 215, 0, 0.8);
                background: rgba(255, 215, 0, 0.3);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
                background: rgba(255, 215, 0, 0.2);
            }
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px auto;
            width: 90%;
            max-width: 400px;
            padding: 0 10px;
        }

        .control-btn {
            flex: 1;
            max-width: 120px;
            background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(255,107,107,0.3);
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 90px;
            height: 36px;
            line-height: 20px;
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        /* æ·»åŠ æ»‘åŠ¨è¿”å›åŒºåŸŸ */
        .slide-back-area {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 20px;
            z-index: 1000;
        }

        /* æ¸¸æˆç»“æŸå¼¹çª— */
        .game-over-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            width: 80%;
            max-width: 300px;
            animation: slideUp 0.3s ease;
        }

        /* ä¿®æ”¹æˆåŠŸå’Œå¤±è´¥çŠ¶æ€çš„æ ·å¼ */
        .level-complete, .level-failed {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .final-score, .player-score {
            font-size: 16px;
            margin: 10px 0;
            color: #FF6B6B;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .modal-buttons .control-btn {
            font-size: 14px;
            padding: 8px 20px;
            border-radius: 20px;
        }

        .failed-image {
            width: 60px;
            height: 60px;
            margin: 5px 0;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* ä¿®æ”¹é€‰ä¸­æ•ˆæœçš„æ ·å¼ */
        .candy {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            background: rgba(255, 255, 255, 0.1);
        }

        .candy.selected {
            transform: scale(1.15);
            z-index: 2;
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.6);
            animation: pulse 1s infinite;
        }

        .candy.hint {
            animation: hintPulse 1s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 15px rgba(255, 107, 107, 0.6);
                background: rgba(255, 107, 107, 0.2);
            }
            50% {
                box-shadow: 0 0 25px rgba(255, 107, 107, 0.8);
                background: rgba(255, 107, 107, 0.3);
            }
            100% {
                box-shadow: 0 0 15px rgba(255, 107, 107, 0.6);
                background: rgba(255, 107, 107, 0.2);
            }
        }

        @keyframes hintPulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
                background: rgba(255, 215, 0, 0.2);
            }
            50% {
                transform: scale(1.1);
                box-shadow: 0 0 25px rgba(255, 215, 0, 0.8);
                background: rgba(255, 215, 0, 0.3);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
                background: rgba(255, 215, 0, 0.2);
            }
        }

        /* æ·»åŠ æ™ƒåŠ¨åŠ¨ç”»æ ·å¼ */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* æ·»åŠ æš‚åœæŒ‰é’®æ ·å¼ */
        .control-btn.pause {
            background: linear-gradient(135deg, #4ECDC4, #45B7D1);
        }

        /* æ·»åŠ æ¸¸æˆæš‚åœé®ç½©å±‚æ ·å¼ */
        .pause-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        /* ä¿®æ”¹æš‚åœå†…å®¹å®¹å™¨æ ·å¼ */
        .pause-content {
            background: white;
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            width: 80%;
            max-width: 280px;
            animation: slideUp 0.3s ease;
        }

        /* ä¿®æ”¹æš‚åœæ ‡é¢˜æ ·å¼ */
        .pause-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
        }

        /* ä¿®æ”¹æš‚åœæŒ‰é’®å®¹å™¨æ ·å¼ */
        .pause-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        /* ä¿®æ”¹æš‚åœæŒ‰é’®æ ·å¼ */
        .pause-buttons .control-btn {
            font-size: 14px;
            padding: 8px 16px;
            width: 100px;
            height: 36px;
            line-height: 20px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            border-radius: 18px;
            background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        /* æŒ‰é’®æ‚¬åœæ•ˆæœ */
        .pause-buttons .control-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(255,107,107,0.3);
        }

        /* æŒ‰é’®ç‚¹å‡»æ•ˆæœ */
        .pause-buttons .control-btn:active {
            transform: scale(0.95);
        }

        /* æ·»åŠ æ ‡åˆ†æ•°å®¹å™¨æ ·å¼ */
        .target-container {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            background: #fff;
            margin: 10px 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 400px;
        }

        .target-label {
            font-size: 14px;
            color: #666;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .target-value {
            font-size: 16px;
            font-weight: 600;
            color: #FF6B6B;
        }

        /* å…³å¡æ ‡ç­¾æ ·å¼ */
        .level-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .level-label .material-icons {
            font-size: 14px;
            color: #4ECDC4;
        }

        /* æ”¹ç¤¼èŠ±åŠ¨ç”»æ ·å¼ */
        .confetti {
            position: fixed; /* æ”¹ä¸ºfixedå®šä½ï¼Œä»é¡¶å¼€å§‹ */
            top: -20px; /* ä»å±å¹•é¡¶éƒ¨ä¸Šæ–¹å¼€å§‹ */
            width: 8px;
            height: 8px;
            opacity: 0;
            animation: confetti-fall 3s ease-in-out infinite;
            z-index: 1001; /* ç¡®ä¿åœ¨æœ€ä¸Šå±‚ */
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* ä¿®æ”¹æŒ‰é’®æ–‡å­—æ ·å¼ */
        .modal-buttons .control-btn {
            font-size: 12px;
            padding: 8px 15px;
            max-width: 100px;
            white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ¢è¡Œ */
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ä¿®æ”¹æˆåŠŸå¼¹çª—æ ·å¼ */
        .level-complete {
            font-size: 24px;
            font-weight: bold;
            color: #FF6B6B;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            position: relative;
            z-index: 1002; /* ç¡®ä¿æ–‡å­—åœ¨ç¤¼èŠ±ä¸Šå±‚ */
        }

        .level-complete .emoji {
            font-size: 40px;
            margin: 10px 0;
        }

        /* ä¿®æ”¹å¤±è´¥å¼¹çª—æ ·å¼ */
        .level-failed {
            font-size: 24px;
            font-weight: bold;
            color: #666;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .level-failed .emoji {
            font-size: 40px;
            margin: 10px 0;
        }

        .failed-image {
            width: 100px;
            height: 100px;
            margin: 10px 0;
        }

        /* ä¿®æ”¹æ¸¸æˆç»“å¼¹çª—æŒ‰é’®æ ·å¼ */
        .modal-buttons .control-btn {
            font-size: 12px;
            padding: 8px 15px;
            max-width: 100px;
        }

        /* æ·»åŠ æç¤ºæ¬¡æ•°æ˜¾ç¤ºæ ·å¼ */
        .hint-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #FF6B6B;
            color: white;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 20px;
            height: 20px;
            line-height: 16px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* ä¿®æ”¹æç¤ºæŒ‰é’®æ ·å¼ */
        .control-btn.hint {
            position: relative;
            padding-right: 25px;
        }

        .hint-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #FF6B6B;
            color: white;
            font-size: 12px;
            min-width: 20px;
            height: 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 2;
            pointer-events: none;
        }

        /* ç¦ç”¨çŠ¶æ€çš„ç¤ºæŒ‰é’® */
        .control-btn.hint.disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* æ·»åŠ æ’è¡Œæ¦œæ ·å¼ */
        .leaderboard-preview {
            margin: 15px 0;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 10px;
        }

        .leaderboard-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .leaderboard-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background: #f5f5f5;
            border-radius: 6px;
            font-size: 12px;
        }

        .leaderboard-item .rank {
            width: 20px;
            text-align: center;
            font-weight: bold;
            margin-right: 10px;
        }

        .leaderboard-item .score {
            flex: 1;
            color: #FF6B6B;
            font-weight: 600;
        }

        .leaderboard-item .level {
            margin: 0 10px;
            color: #666;
        }

        .leaderboard-item .date {
            color: #999;
            font-size: 10px;
        }

        .leaderboard-item.top-1 {
            background: linear-gradient(135deg, #FFD700, #FFC107);
            color: white;
        }

        .leaderboard-item.top-2 {
            background: linear-gradient(135deg, #C0C0C0, #9E9E9E);
            color: white;
        }

        .leaderboard-item.top-3 {
            background: linear-gradient(135deg, #CD7F32, #8D6E63);
            color: white;
        }

        .no-records {
            text-align: center;
            color: #999;
            padding: 10px;
        }

        .sweet-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            text-align: center;
            z-index: 9999;
            width: 280px;
            animation: sweetAlertFadeIn 0.3s ease-out;
        }

        @keyframes sweetAlertFadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .sweet-alert-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .sweet-alert-title {
            color: #333;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .sweet-alert-button {
            background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .sweet-alert-button:active {
            transform: scale(0.95);
        }

        .sweet-alert-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 9998;
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background: #f5f5f5;
            border-radius: 6px;
            font-size: 12px;
            gap: 10px;
        }

        .leaderboard-item .time {
            color: #FF6B6B;
            font-weight: 500;
        }

        .confetti {
            animation: confetti-fall 3s ease-in-out forwards; /* æ”¹ä¸ºforwardsï¼ŒåŠ¨ç”»åªæ’­æ”¾ä¸€æ¬¡ */
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .player-score {
            font-size: 20px;
            font-weight: 600;
            color: #4ECDC4;
            margin: 10px 0;
        }

        .score-details {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            font-size: 14px;
            color: #666;
        }

        .score-details div {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
        }

        /* ä¿®æ”¹å¼¹çª—å®¹å™¨æ ·å¼ */
        .tips-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        /* ä¿®æ”¹å¼¹çª—å†…å®¹æ ·å¼ */
        .tips-modal-content {
            background: white;
            padding: 20px;
            border-radius: 12px;
            width: 80%;
            max-width: 300px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: modalFadeIn 0.3s ease;
        }

        /* æ·»åŠ å¼¹çª—åŠ¨ç”» */
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* å¼¹çª—æ ‡é¢˜æ ·å¼ */
        .tips-modal-title {
            font-size: 16px;
            font-weight: 500;
            color: #333;
            margin-bottom: 12px;
        }

        /* å¼¹çª—æŒ‰é’®æ ·å¼ */
        .tips-modal-button {
            background: #FF6B6B;
            color: white;
            border: none;
            padding: 8px 24px;
            border-radius: 20px;
            font-size: 14px;
            margin-top: 16px;
            cursor: pointer;
        }

        .tips-modal-button:active {
            transform: scale(0.98);
        }

        /* ä¿®æ”¹æç¤ºæŒ‰é’®å’Œæç¤ºæ¬¡æ•°çš„æ ·å¼ */
        .control-btn.hint {
            position: relative;
            padding-right: 25px;
        }

        .hint-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #FF6B6B;
            color: white;
            font-size: 12px;
            min-width: 20px;
            height: 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 2;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="slide-back-area"></div>

    <div class="game-wrapper">
        <div class="score-panel">
            <div class="score-item">
                <div class="score-label">
                    <i class="material-icons">stars</i>
                    åˆ†æ•°
                </div>
                <div class="score-value" id="score">0</div>
            </div>
            <div class="score-item">
                <div class="level-label">
                    <i class="material-icons">military_tech</i>
                    å…³å¡
                </div>
                <div class="score-value" id="level">1</div>
            </div>
            <div class="time-item">
                <i class="material-icons">timer</i>
                <div class="time-value" id="timer">0:34</div>
            </div>
        </div>

        <div class="target-container">
            <div class="target-label">
                <i class="material-icons" style="color: #FF6B6B;">flag</i>
                ç›®æ ‡åˆ†æ•°
            </div>
            <div class="target-value" id="targetScore">1000</div>
        </div>

        <div class="game-container">
            <div class="game-grid" id="gameGrid"></div>
        </div>

        <div class="controls">
            <button class="control-btn" onclick="restartGame()">é‡æ–°å¼€å§‹</button>
            <button class="control-btn hint" onclick="showHint()">
                æç¤º
                <span class="hint-count">3</span>
            </button>
            <button class="control-btn pause" onclick="togglePause()">æš‚åœ</button>
        </div>

        <div class="game-over-modal" id="gameOverModal">
            <div class="modal-content">
                <h2>æ¸¸æˆç»“æŸ</h2>
                <div class="final-score">å¾—åˆ†: <span id="finalScore">0</span></div>
                <div class="modal-buttons">
                    <button class="control-btn" onclick="restartGame()">å†ç©ä¸€æ¬¡</button>
                    <button class="control-btn" onclick="window.location.href='quwanyouxi.html'">è¿”å›åˆ—</button>
                </div>
            </div>
        </div>

        <div class="pause-overlay" id="pauseOverlay">
            <div class="pause-content">
                <div class="pause-title">æ¸¸æˆæš‚åœ</div>
                <div class="pause-buttons">
                    <button class="control-btn" onclick="resumeGame()">ç»§ç»­æ¸¸æˆ</button>
                    <button class="control-btn" onclick="window.location.href='quwanyouxi.html'">é€€å‡ºæ¸¸æˆ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const GRID_SIZE = 8;
        const CANDY_TYPES = ['ğŸ', 'ğŸŠ', 'ğŸ‡', 'ğŸ“', 'ğŸª', 'ğŸ«'];
        let score = 0;
        let moves = 30;
        let selectedCandy = null;
        let grid = [];

        // æ·»åŠ å…³å¡å’Œå€’è®¡æ—¶ç›¸å…³å˜é‡
        let currentLevel = 1;
        let timeLeft = 120; // åˆå§‹120ç§’
        let timer = null;
        let targetScore = 1000; // åˆå§‹ç›®æ ‡åˆ†æ•°

        // ä¿®æ”¹å…³å¡é…ç½®ï¼Œè°ƒæ•´æ¯å…³çš„ç›®æ ‡åˆ†æ•°
        const levelConfig = {
            1: { target: 200, time: 60, gridSize: 8, minMatch: 3 },     // 1åˆ†é’Ÿ, 200åˆ†
            2: { target: 500, time: 120, gridSize: 8, minMatch: 3 },    // 2åˆ†é’Ÿ, 500åˆ†
            3: { target: 1000, time: 300, gridSize: 8, minMatch: 3 },   // 5åˆ†é’Ÿ, 1000åˆ†
            4: { target: 1300, time: 480, gridSize: 8, minMatch: 3 },   // 8åˆ†é’Ÿ, 1300åˆ†
            5: { target: 1800, time: 660, gridSize: 8, minMatch: 4 },   // 11åˆ†é’Ÿ, 1800åˆ†
            6: { target: 2500, time: 900, gridSize: 8, minMatch: 4 },   // 15åˆ†é’Ÿ, 2500åˆ†
            7: { target: 3000, time: 1200, gridSize: 8, minMatch: 4 },  // 20åˆ†é’Ÿ, 3000åˆ†
            8: { target: 4000, time: 1500, gridSize: 8, minMatch: 4 },  // 25åˆ†é’Ÿ, 4000åˆ†
            9: { target: 6000, time: 1800, gridSize: 8, minMatch: 5 },  // 30åˆ†é’Ÿ, 6000åˆ†
            10: { target: 9000, time: 1800, gridSize: 8, minMatch: 5 }  // 30åˆ†é’Ÿ, 9000åˆ†
        };

        // æ·»åŠ æš‚åœçŠ¶æ€å˜é‡
        let isPaused = false;
        let savedTimeLeft = 0;

        // æ·»åŠ æç¤ºæ¬¡æ•°é™åˆ¶
        let hintCount = 3;

        // æš‚åœ/ç»§ç»­åˆ‡æ¢å‡½æ•°
        function togglePause() {
            if (isPaused) {
                resumeGame();
            } else {
                pauseGame();
            }
        }

        // æš‚åœæ¸¸æˆ
        function pauseGame() {
            isPaused = true;
            savedTimeLeft = timeLeft;
            clearInterval(timer);
            
            // æ˜¾ç¤ºæš‚åœé®ç½©
            document.getElementById('pauseOverlay').style.display = 'flex';
            
            // ç¦ç”¨æ¸¸æˆç½‘æ ¼ç‚¹å‡»
            const gameGrid = document.getElementById('gameGrid');
            gameGrid.style.pointerEvents = 'none';
            
            // æ›´æ”¹æš‚åœæŒ‰é’®æ–‡æœ¬
            document.querySelector('.control-btn.pause').textContent = 'ç»§ç»­';
        }

        // ç»§ç»­æ¸¸æˆ
        function resumeGame() {
            isPaused = false;
            timeLeft = savedTimeLeft;
            
            // é‡æ–°å¯åŠ¨è®¡æ—¶å™¨
            timer = setInterval(() => {
                if (!isPaused) {
                    timeLeft--;
                    updateTimer();
                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        checkLevelComplete();
                    }
                }
            }, 1000);
            
            // éšè—æš‚åœé®ç½©
            document.getElementById('pauseOverlay').style.display = 'none';
            
            // æ¢å¤æ¸¸æˆç½‘æ ¼ç‚¹å‡»
            const gameGrid = document.getElementById('gameGrid');
            gameGrid.style.pointerEvents = 'auto';
            
            // æ›´æ”¹æš‚åœæŒ‰é’®æ–‡æœ¬
            document.querySelector('.control-btn.pause').textContent = 'æš‚åœ';
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            isPaused = false;
            
            // ç¡®ä¿å½“å‰å…³å¡æœ‰æ•ˆ
            if (!levelConfig[currentLevel]) {
                currentLevel = 1;
            }
            
            const config = levelConfig[currentLevel];
            timeLeft = config.time;
            targetScore = config.target;
            score = 0;
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('targetScore').textContent = targetScore;
            document.getElementById('level').textContent = currentLevel;
            updateTimer();
            document.getElementById('score').textContent = '0';
            
            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            if (timer) clearInterval(timer);
            
            // å¼€å§‹å€’è®¡æ—¶
            timer = setInterval(() => {
                if (!isPaused) {
                    timeLeft--;
                    updateTimer();
                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        checkLevelComplete();
                    }
                }
            }, 1000);

            // åˆå§‹åŒ–æ¸¸æˆç½‘æ ¼
            const gameGrid = document.getElementById('gameGrid');
            gameGrid.innerHTML = '';
            grid = [];

            // åˆ›å»ºåˆå§‹ç½‘æ ¼
            const gridSize = config.gridSize || 8; // ä½¿ç”¨é…ç½®ä¸­çš„ç½‘æ ¼å¤§å°
            for (let i = 0; i < gridSize; i++) {
                grid[i] = [];
                for (let j = 0; j < gridSize; j++) {
                    const candy = createCandy(i, j);
                    gameGrid.appendChild(candy);
                    grid[i][j] = candy;
                }
            }

            // ç¡®ä¿åˆå§‹çŠ¶æ€æ²¡æœ‰åŒ¹é…
            while (checkMatches().length > 0) {
                shuffleGrid();
            }

            // é‡ç½®æš‚åœæŒ‰é’®æ–‡æœ¬
            document.querySelector('.control-btn.pause').textContent = 'æš‚åœ';
            document.getElementById('pauseOverlay').style.display = 'none';

            // é‡ç½®æç¤ºæ¬¡æ•°å¹¶æ›´æ–°æ˜¾ç¤º
            hintCount = 3;
            updateHintButton();
            
            // å¯ç”¨æ¸¸æˆæ ¼ç‚¹å‡»
            gameGrid.style.pointerEvents = 'auto';
        }

        // åˆ›å»ºç³–æœå…ƒç´ 
        function createCandy(row, col) {
            const candy = document.createElement('div');
            candy.className = 'candy';
            candy.dataset.row = row;
            candy.dataset.col = col;
            candy.textContent = CANDY_TYPES[Math.floor(Math.random() * CANDY_TYPES.length)];
            
            candy.addEventListener('click', () => handleCandyClick(candy));
            
            return candy;
        }

        // æ·»åŠ è‡ªåŠ¨æç¤ºåŠŸèƒ½
        let lastInteractionTime = Date.now();
        let hintTimer = null;

        // ä¿®handleCandyClickå‡½æ•°
        function handleCandyClick(candy) {
            if (isPaused) return;
            
            lastInteractionTime = Date.now();
            clearTimeout(hintTimer);
            startHintTimer();

            if (!selectedCandy) {
                // ç¬¬ä¸€æ¬¡é€‰æ‹©
                selectedCandy = candy;
                candy.classList.add('selected');
            } else {
                // ç¬¬äºŒæ¬¡é€‰æ‹©
                const row1 = parseInt(selectedCandy.dataset.row);
                const col1 = parseInt(selectedCandy.dataset.col);
                const row2 = parseInt(candy.dataset.row);
                const col2 = parseInt(candy.dataset.col);

                if (selectedCandy === candy) {
                    // å¦‚æœç‚¹å‡»åŒä¸€ä¸ªç³–æœï¼Œå–æ¶ˆé€‰æ‹©
                    selectedCandy.classList.remove('selected');
                    selectedCandy = null;
                } else if (isAdjacent(row1, col1, row2, col2)) {
                    // å¦‚æœç›¸é‚»ï¼Œæ£€æŸ¥äº¤æ¢åæ˜¯å¦èƒ½å½¢æˆä¸‰è¿
                    const tempText = selectedCandy.textContent;
                    
                    // ä¸´æ—¶äº¤æ¢ä»¥æ£€æŸ¥æ˜¯å¦èƒ½å½¢æˆåŒ¹é…
                    selectedCandy.textContent = candy.textContent;
                    candy.textContent = tempText;

                    // æ£€æŸ¥äº¤æ¢åæ˜¯å¦å½¢æˆåŒ¹é…
                    const matches = checkMatches();
                    
                    // å…ˆäº¤æ¢å›æ¥
                    candy.textContent = selectedCandy.textContent;
                    selectedCandy.textContent = tempText;

                    if (matches.length >= 3) {
                        // å¦‚æœå¯ä»¥å½¢æˆä¸‰è¿ï¼Œå†æ¬¡äº¤æ¢å¹¶æ‰§è¡Œæ¶ˆé™¤
                        selectedCandy.textContent = candy.textContent;
                        candy.textContent = tempText;
                        selectedCandy.classList.remove('selected');
                        handleMatches(matches);
                    } else {
                        // å¦‚æœä¸èƒ½å½¢æˆä¸‰è¿ï¼Œæ·»åŠ æ™ƒåŠ¨åŠ¨ç”»
                        candy.style.animation = 'shake 0.5s';
                        selectedCandy.style.animation = 'shake 0.5s';
                        setTimeout(() => {
                            candy.style.animation = '';
                            selectedCandy.style.animation = '';
                        }, 500);
                        selectedCandy.classList.remove('selected');
                    }
                    selectedCandy = null;
                } else {
                    // å¦‚æœä¸ç›¸é‚»ï¼Œå–æ¶ˆä¹‹å‰çš„é€‰æ‹©ï¼Œé€‰æ‹©æ–°çš„ç³–æœ
                    selectedCandy.classList.remove('selected');
                    selectedCandy = candy;
                    candy.classList.add('selected');
                }
            }
        }

        // ä¿®æ”¹isAdjacentå‡½æ•°ï¼Œä½¿å…¶æ›´ç²¾ç¡®
        function isAdjacent(row1, col1, row2, col2) {
            const rowDiff = Math.abs(row1 - row2);
            const colDiff = Math.abs(col1 - col2);
            // ç¡®ä¿åªæœ‰ä¸Šä¸‹å³ç›¸é‚»çš„æ‰èƒ½äº¤æ¢
            return (rowDiff === 1 && colDiff === 0) || (rowDiff === 0 && colDiff === 1);
        }

        // äº¤æ¢ä¸¤ä¸ªç³–æœ
        async function swapCandies(candy1, candy2) {
            const tempText = candy1.textContent;
            candy1.textContent = candy2.textContent;
            candy2.textContent = tempText;

            // æ£€æŸ¥å¦å½¢æˆåŒ¹é…
            const matches = checkMatches();
            if (matches.length > 0) {
                await handleMatches(matches);
            } else {
                // å¦‚æœæ²¡æœ‰åŒ¹é…ï¼Œäº¤æ¢å›æ¥
                candy1.textContent = candy2.textContent;
                candy2.textContent = tempText;
            }
        }

        // æ£€æŸ¥åŒ¹é…
        function checkMatches() {
            const matches = new Set();

            // æ£€æŸ¥è¡Œ
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE - 2; j++) {
                    if (grid[i][j].textContent && 
                        grid[i][j].textContent === grid[i][j+1].textContent &&
                        grid[i][j].textContent === grid[i][j+2].textContent) {
                        matches.add(grid[i][j]);
                        matches.add(grid[i][j+1]);
                        matches.add(grid[i][j+2]);
                        
                        // æ£€æŸ¥æ˜¯å¦æœ‰æ›´å¤šç›¸åŒçš„ç³–æœ
                        let k = j + 3;
                        while (k < GRID_SIZE && grid[i][k].textContent === grid[i][j].textContent) {
                            matches.add(grid[i][k]);
                            k++;
                        }
                    }
                }
            }

            // æ£€æŸ¥åˆ—
            for (let j = 0; j < GRID_SIZE; j++) {
                for (let i = 0; i < GRID_SIZE - 2; i++) {
                    if (grid[i][j].textContent && 
                        grid[i][j].textContent === grid[i+1][j].textContent &&
                        grid[i][j].textContent === grid[i+2][j].textContent) {
                        matches.add(grid[i][j]);
                        matches.add(grid[i+1][j]);
                        matches.add(grid[i+2][j]);
                        
                        // æ£€æŸ¥æ˜¯å¦æœ‰æ›´å¤šç›¸åŒçš„ç³–æœ
                        let k = i + 3;
                        while (k < GRID_SIZE && grid[k][j].textContent === grid[i][j].textContent) {
                            matches.add(grid[k][j]);
                            k++;
                        }
                    }
                }
            }

            return Array.from(matches);
        }

        // å¤„åŒ¹é…
        async function handleMatches(matches) {
            if (matches.length < 3) return;

            // æ·»åŠ æ¶ˆé™¤åŠ¨ç”»
            matches.forEach(candy => {
                candy.classList.add('matched');
            });

            await new Promise(resolve => setTimeout(resolve, 300));

            // è®¡ç®—åˆ†æ•°
            let baseScore = matches.length * 10;
            if (matches.length > 3) {
                baseScore += (matches.length - 3) * 5;
            }

            // æ›´æ–°åˆ†æ•°å¹¶æ£€æŸ¥æ˜¯å¦æ¸¸æˆç»“æŸ
            const isGameComplete = updateScore(score + baseScore);
            if (isGameComplete) {
                return; // å¦‚æœæ¸¸æˆç»“æŸï¼Œç›´æ¥è¿”å›ä¸ç»§ç»­å¤„ç†
            }

            // ç§»é™¤åŒ¹é…çš„ç³–æœ
            matches.forEach(candy => {
                candy.textContent = '';
                candy.classList.remove('matched');
            });

            // ä¸‹è½ç³–æœ
            await dropCandies();

            // å¡«å……æ–°çš„ç³–æœ
            fillNewCandies();

            // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰æ–°çš„åŒ¹é…
            const newMatches = checkMatches();
            if (newMatches.length >= 3) {
                await handleMatches(newMatches);
            }
        }

        // ä¸‹è½ç³–æœ
        async function dropCandies() {
            let dropped = false;

            for (let j = 0; j < GRID_SIZE; j++) {
                for (let i = GRID_SIZE - 1; i > 0; i--) {
                    if (grid[i][j].textContent === '') {
                        for (let k = i - 1; k >= 0; k--) {
                            if (grid[k][j].textContent !== '') {
                                grid[i][j].textContent = grid[k][j].textContent;
                                grid[k][j].textContent = '';
                                dropped = true;
                                break;
                            }
                        }
                    }
                }
            }

            if (dropped) {
                await new Promise(resolve => setTimeout(resolve, 200));
            }

            return dropped;
        }

        // å¡«å……æ–°çš„ç³–æœ
        function fillNewCandies() {
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    if (grid[i][j].textContent === '') {
                        grid[i][j].textContent = CANDY_TYPES[Math.floor(Math.random() * CANDY_TYPES.length)];
                    }
                }
            }
        }

        // ä¿®æ”¹æ›´æ–°åˆ†æ•°å‡½æ•°
        function updateScore(newScore) {
            const multiplier = Math.max(1, Math.floor(currentLevel / 2));
            score = newScore * multiplier;
            document.getElementById('score').textContent = score;
            
            // ç«‹å³æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ç›®æ ‡åˆ†æ•°
            if (score >= targetScore) {
                // ç«‹å³ç¦ç”¨æ¸¸æˆç½‘æ ¼ç‚¹å‡»
                const gameGrid = document.getElementById('gameGrid');
                gameGrid.style.pointerEvents = 'none';
                
                // æ¸…é™¤è®¡æ—¶å™¨
                clearInterval(timer);
                
                // ç«‹å³æ˜¾ç¤ºé€šå…³ç•Œé¢
                checkLevelComplete();
                return true; // è¿”å›trueè¡¨ç¤ºæ¸¸æˆç»“æŸ
            }
            return false; // è¿”å›falseè¡¨ç¤ºæ¸¸æˆç»§ç»­
        }

        // æ›´æ–°æ­¥æ•°
        function updateMoves(newMoves) {
            moves = newMoves;
            document.getElementById('moves').textContent = moves;
            if (moves === 0) {
                gameOver();
            }
        }

        // æ¸¸æˆæŸ
        function gameOver() {
            document.getElementById('finalScore').textContent = score;
            document.getElementById('gameOverModal').style.display = 'flex';
        }

        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            document.getElementById('gameOverModal').style.display = 'none';
            setTimeout(() => {
                initGame();
            }, 500); // æ·»åŠ çŸ­æš‚å»¶è¿Ÿç¡®ä¿UIæ›´æ–°
        }

        // æç¤ºåŠŸèƒ½
        function showHint() {
            if (hintCount <= 0) {
                showSweetAlert('æç¤ºæ¬¡æ•°å·²ç”¨å®Œ', 'ğŸ”’', event.currentTarget);
                return;
            }
            
            // å…ˆæ¸…é™¤ä¹‹å‰çš„æç¤ºæ•ˆæœ
            document.querySelectorAll('.candy.hint').forEach(candy => {
                candy.classList.remove('hint');
            });
            
            // æŸ¥æ‰¾å¯ä»¥ç›´æ¥æ¶ˆé™¤çš„ä¸‰ä¸ªç›¸è¿ç‰©å“
            let hintFound = false;
            let hintCandies = [];
            
            // æ£€æŸ¥æ°´å¹³æ–¹å‘çš„ä¸‰ä¸ªç›¸è¿
            for (let i = 0; i < GRID_SIZE && !hintFound; i++) {
                for (let j = 0; j < GRID_SIZE - 2 && !hintFound; j++) {
                    if (grid[i][j].textContent !== '' &&
                        grid[i][j].textContent === grid[i][j+1].textContent &&
                        grid[i][j].textContent === grid[i][j+2].textContent) {
                        hintCandies = [grid[i][j], grid[i][j+1], grid[i][j+2]];
                        hintFound = true;
                        break;
                    }
                }
            }
            
            // æ£€æŸ¥å‚ç›´æ–¹å‘çš„ä¸‰ä¸ªç›¸è¿
            if (!hintFound) {
                for (let j = 0; j < GRID_SIZE && !hintFound; j++) {
                    for (let i = 0; i < GRID_SIZE - 2 && !hintFound; i++) {
                        if (grid[i][j].textContent !== '' &&
                            grid[i][j].textContent === grid[i+1][j].textContent &&
                            grid[i][j].textContent === grid[i+2][j].textContent) {
                            hintCandies = [grid[i][j], grid[i+1][j], grid[i+2][j]];
                            hintFound = true;
                            break;
                        }
                    }
                }
            }

            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç›´æ¥ç›¸è¿çš„ï¼Œæ£€æŸ¥æ½œåœ¨çš„å¯äº¤æ¢ç»„åˆ
            if (!hintFound) {
                // æ£€æŸ¥æ°´å¹³æ–¹å‘çš„æ½œåœ¨åŒ¹é…
                for (let i = 0; i < GRID_SIZE && !hintFound; i++) {
                    for (let j = 0; j < GRID_SIZE - 1 && !hintFound; j++) {
                        // å°è¯•äº¤æ¢å¹¶æ£€æŸ¥
                        const temp = grid[i][j].textContent;
                        grid[i][j].textContent = grid[i][j+1].textContent;
                        grid[i][j+1].textContent = temp;
                        
                        if (checkMatches().length >= 3) {
                            hintCandies = [grid[i][j], grid[i][j+1]];
                            hintFound = true;
                        }
                        
                        // äº¤æ¢å›æ¥
                        grid[i][j+1].textContent = grid[i][j].textContent;
                        grid[i][j].textContent = temp;
                    }
                }

                // æ£€æŸ¥å‚ç›´æ–¹å‘çš„æ½œåœ¨åŒ¹é…
                if (!hintFound) {
                    for (let j = 0; j < GRID_SIZE && !hintFound; j++) {
                        for (let i = 0; i < GRID_SIZE - 1 && !hintFound; i++) {
                            const temp = grid[i][j].textContent;
                            grid[i][j].textContent = grid[i+1][j].textContent;
                            grid[i+1][j].textContent = temp;
                            
                            if (checkMatches().length >= 3) {
                                hintCandies = [grid[i][j], grid[i+1][j]];
                                hintFound = true;
                            }
                            
                            // äº¤æ¢å›æ¥
                            grid[i+1][j].textContent = grid[i][j].textContent;
                            grid[i][j].textContent = temp;
                        }
                    }
                }
            }

            if (hintFound) {
                // å‡å°‘æç¤ºæ¬¡æ•°
                hintCount--;
                updateHintButton();
                
                // é«˜äº®æ˜¾ç¤ºæç¤ºçš„ç³–æœ
                hintCandies.forEach(candy => {
                    candy.classList.add('hint');
                });
                
                // 3ç§’åç§»é™¤é«˜äº®æ•ˆæœ
                setTimeout(() => {
                    hintCandies.forEach(candy => {
                        candy.classList.remove('hint');
                    });
                }, 3000);
            } else {
                // å¦‚æœç¡®å®æ²¡æœ‰å¯æ¶ˆé™¤çš„ç»„åˆï¼Œæ‰æ˜¾ç¤ºé‡æ–°æ’åˆ—æç¤º
                showSweetAlert('æ­£åœ¨é‡æ’åˆ—æ¸¸æˆæ£‹ç›˜...', 'ğŸ”„', event.currentTarget);
                setTimeout(() => {
                    shuffleGrid();
                    document.querySelector('.sweet-alert-backdrop').remove();
                    document.querySelector('.sweet-alert').remove();
                }, 1500);
            }
        }

        // æ‰“ä¹±ç½‘æ ¼
        function shuffleGrid() {
            const candies = [];
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    candies.push(grid[i][j].textContent);
                }
            }

            // éšæœºä¹±
            for (let i = candies.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [candies[i], candies[j]] = [candies[j], candies[i]];
            }

            // é‡æ–°å¡«å……ç½‘æ ¼
            let index = 0;
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    grid[i][j].textContent = candies[index++];
                }
            }
        }

        // ä¿®æ”¹æ»‘åŠ¨è¿”å›åŠŸèƒ½
        let startX = 0;
        let startY = 0;
        const threshold = 50;

        document.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        });

        document.addEventListener('touchmove', (e) => {
            if (startX < 50) {
                const deltaX = e.touches[0].clientX - startX;
                const deltaY = Math.abs(e.touches[0].clientY - startY);
                
                if (deltaX > deltaY && deltaX > 0) {
                    e.preventDefault();
                }
            }
        }, { passive: false });

        document.addEventListener('touchend', (e) => {
            if (startX < 50) {
                const deltaX = e.changedTouches[0].clientX - startX;
                const deltaY = Math.abs(e.changedTouches[0].clientY - startY);
                
                if (deltaX > threshold && deltaX > deltaY) {
                    window.location.href = 'quwanyouxi.html';
                }
            }
        });

        // ä¿®æ”¹checkLevelCompleteå‡½æ•°
        function checkLevelComplete() {
            clearInterval(timer);
            
            // ç¦ç”¨æ¸¸æˆç½‘æ ¼ç‚¹å‡»
            const gameGrid = document.getElementById('gameGrid');
            gameGrid.style.pointerEvents = 'none';
            
            // æ¸…é™¤æ‰€æœ‰æ­£åœ¨è¿›è¡Œçš„åŠ¨ç”»
            document.querySelectorAll('.candy').forEach(candy => {
                candy.classList.remove('matched', 'selected', 'hint');
                candy.style.animation = '';
            });
            
            if (score >= targetScore) {
                // é€šå…³
                showLevelComplete(true);
            } else {
                // å¤±è´¥
                showLevelComplete(false);
            }
        }

        // ä¿®æ”¹æ¸¸æˆç»“æŸæ˜¾ç¤ºå‡½æ•°
        function showLevelComplete(success) {
            const modal = document.getElementById('gameOverModal');
            const content = modal.querySelector('.modal-content');
            
            if (success) {
                const scoreResult = calculatePlayerScore(score, timeLeft, currentLevel);
                content.innerHTML = `
                    <div class="level-complete">
                        <span style="font-size: 40px;">ğŸ‰</span>
                        æ­å–œé€šå…³ï¼
                    </div>
                    <div class="final-score">æ¸¸æˆå¾—åˆ†: ${score}</div>
                    <div class="player-score">è·å¾—ç§¯åˆ†: ${scoreResult.total}</div>
                    <div class="modal-buttons">
                        <button class="control-btn" onclick="nextLevel()">ä¸‹ä¸€å…³</button>
                        <button class="control-btn" onclick="window.location.href='quwanyouxi.html'">è¿”å›</button>
                    </div>
                `;
                createConfetti();
            } else {
                const scoreResult = calculatePlayerScore(score, timeLeft, currentLevel);
                content.innerHTML = `
                    <div class="level-failed">
                        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNiAzNiI+PHBhdGggZmlsbD0iI0ZGQ0M0RCIgZD0iTTM2IDE4YzAgOS45NDEtOC4wNTkgMTgtMTggMTgtOS45NCAwLTE4LTguMDU5LTE4LTE4QzAgOC4wNiA4LjA2IDAgMTggMGM5Ljk0MSAwIDE4IDguMDYgMTggMTgiLz48cGF0aCBmaWxsPSIjNjY0NTAwIiBkPSJNMjkuNSAxOS43MDFjLS4xMjQtLjA2NS0uMjUzLS4xMzUtLjQxNC0uMjItLjIzNy0uMTI1LS40ODctLjI2NC0uNzY3LS40Mi0uMjEzLS4xMi0uNDM2LS4yNDctLjY3MS0uMzc3LS4xMjMtLjA2OS0uMjQ4LS4xMzctLjM3NC0uMjA2LS44NzUtLjQ4MS0xLjc3Ny0uOTU3LTIuNzA1LTEuMzg4bC0xLjAxMy0uNDY3Yy0uMjQ1LS4xMDctLjQ3LS4yMDEuNjg0LS4yODcuMjE0LS4wODUuNDI0LS4xNjEuNjE3LS4yMjUuMTkxLS4wNjQuMzY2LS4xMTguNTE2LS4xNTguMTUxLS4wNC4yNzktLjA3MS4zNzQtLjA5MS4wOTYtLjAyMS4xNS0uMDMuMTUtLjAzcy0uMDUzLjAxNS0uMTQ4LjA0MmMtLjA5NS4wMjYtLjIyMi4wNjUtLjM3Mi4xMTItLjE0OS4wNDctLjMyNC4xMDgtLjUxNC4xNzktLjE5MS4wNzEtLjM5OS4xNTQtLjYxMS4yNDctLjIxMy4wOTItLjQzNi4xOTMtLjY3OS4zMDZsLTEuMDA2LjQ4NmMtLjkxOS40NDYtMS44MTEuOTM2LTIuNjc2IDEuNDMtLjEyNC4wNzEtLjI0OC4xNDItLjM3LjIxMy0uMjMyLjEzNS0uNDUyLjI2NS0uNjYyLjM4OS0uMjc3LjE2Mi0uNTIzLjMwNi0uNzU2LjQzNS0uMTU5LjA4OC0uMjg1LjE2LS40MDYuMjI3LS4yNDIuMTMzLS4zNzkuMjA5LS4zNzkuMjA5cy4xNDEtLjA2NS4zODktLjE4NnpNMjMgMjljMCAxLjY1Ny0yLjI0MyA0LTUgNHMtNS0yLjM0My01LTQgMi4yNDMtMiA1LTIgNSAuMzQzIDUgMnoiLz48L3N2Zz4=" class="failed-image" alt="å¤±è´¥è¡¨æƒ…">
                        æŒ‘æˆ˜å¤±è´¥
                    </div>
                    <div class="final-score">æ¸¸æˆå¾—åˆ†: ${score}</div>
                    <div class="player-score">è·å¾—ç§¯åˆ†: ${scoreResult.total}</div>
                    <div class="modal-buttons">
                        <button class="control-btn" onclick="restartGame()">é‡ç©</button>
                        <button class="control-btn" onclick="window.location.href='quwanyouxi.html'">è¿”å›</button>
                    </div>
                `;
            }
            
            modal.style.display = 'flex';
        }

        // æ·»åŠ ä¸‹ä¸€å…³å‡½æ•°
        function nextLevel() {
            if (currentLevel < 10) {  // ä¿®æ”¹ä¸º10å…³
                currentLevel++;
                document.getElementById('gameOverModal').style.display = 'none';
                setTimeout(() => {
                    initGame();
                }, 500);
            } else {
                showSweetAlert('æ­å–œä½ å®Œæˆäº†æ‰€æœ‰å…³å¡ï¼', 'ğŸ‰');
                setTimeout(() => {
                    window.location.href = 'quwanyouxi.html';
                }, 2000);
            }
        }

        // æ·»åŠ è‡ªåŠ¨æç¤ºè®¡æ—¶å™¨
        function startHintTimer() {
            if (hintTimer) {
                clearTimeout(hintTimer);
            }
            
            hintTimer = setTimeout(() => {
                if (Date.now() - lastInteractionTime >= 5000) { // 5ç§’æ— æ“ä½œ
                    showAutoHint();
                }
            }, 5000);
        }

        // è‡ªåŠ¨æç¤ºæ•°
        function showAutoHint() {
            // æ¸…é™¤ä¹‹å‰çš„æç¤º
            document.querySelectorAll('.candy.hint').forEach(candy => {
                candy.classList.remove('hint');
            });

            // æŸ¥æ‰¾å¯ä»¥ç›´æ¥æ¶ˆé™¤çš„ä¸‰ä¸ªç›¸è¿ç‰©å“
            let hintFound = false;
            let hintCandies = [];
            
            // æ£€æŸ¥æ°´å¹³æ–¹å‘
            for (let i = 0; i < GRID_SIZE && !hintFound; i++) {
                for (let j = 0; j < GRID_SIZE - 2 && !hintFound; j++) {
                    if (grid[i][j].textContent !== '' &&
                        grid[i][j].textContent === grid[i][j+1].textContent &&
                        grid[i][j].textContent === grid[i][j+2].textContent) {
                        hintCandies = [grid[i][j], grid[i][j+1], grid[i][j+2]];
                        hintFound = true;
                    }
                }
            }

            // æ£€æŸ¥å‚ç›´æ–¹å‘
            if (!hintFound) {
                for (let j = 0; j < GRID_SIZE && !hintFound; j++) {
                    for (let i = 0; i < GRID_SIZE - 2 && !hintFound; i++) {
                        if (grid[i][j].textContent !== '' &&
                            grid[i][j].textContent === grid[i+1][j].textContent &&
                            grid[i][j].textContent === grid[i+2][j].textContent) {
                            hintCandies = [grid[i][j], grid[i+1][j], grid[i+2][j]];
                            hintFound = true;
                        }
                    }
                }
            }

            if (hintFound) {
                // é«˜äº®æ˜¾ç¤ºå¯ä»¥æ¶ˆé™¤çš„ä¸‰ä¸ªç³–æœ
                hintCandies.forEach(candy => {
                    candy.classList.add('hint');
                });

                // 3ç§’åç§»é™¤æç¤º
                setTimeout(() => {
                    hintCandies.forEach(candy => {
                        candy.classList.remove('hint');
                    });
                    // é‡æ–°å¼€å§‹è®¡æ—¶å™¨
                    startHintTimer();
                }, 3000);
            }
        }

        // æ·»åŠ æ™ƒåŠ¨åŠ¨ç”»æ ·å¼
        const shakeStyle = document.createElement('style');
        shakeStyle.textContent = `
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }`;
        document.head.appendChild(shakeStyle);

        // åœ¨é¡µé¢åŠ è½½æ—¶å¯åŠ¨æç¤ºè®¡æ—¶å™¨
        document.addEventListener('DOMContentLoaded', function() {
            currentLevel = 1;
            initGame();
            startHintTimer();
        });

        // æ·»åŠ é¡µé¢å¯è§æ€§å˜åŒ–ç›‘å¬
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                clearTimeout(hintTimer);
            } else {
                lastInteractionTime = Date.now();
                startHintTimer();
            }
        });

        // ä¿®æ”¹æ—¶é—´æ˜¾ç¤ºæ ¼å¼ï¼Œå°†ç§’æ•°è½¬æ¢ä¸ºåˆ†:ç§’æ ¼å¼
        function updateTimer() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        // æ·»åŠ æ›´æ–°æç¤ºæŒ‰é’®æ˜¾ç¤ºçš„å‡½æ•°
        function updateHintButton() {
            const hintBtn = document.querySelector('.control-btn.hint');
            let hintCountElement = hintBtn.querySelector('.hint-count');
            
            // å¦‚æœæ²¡æœ‰æç¤ºæ¬¡æ•°å…ƒç´ ï¼Œåˆ›å»ºä¸€ä¸ª
            if (!hintCountElement) {
                hintCountElement = document.createElement('span');
                hintCountElement.className = 'hint-count';
                hintBtn.appendChild(hintCountElement);
            }
            
            // æ›´æ–°æç¤ºæ¬¡æ•°æ˜¾ç¤º
            hintCountElement.textContent = hintCount;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            if (hintCount <= 0) {
                hintBtn.classList.add('disabled');
            } else {
                hintBtn.classList.remove('disabled');
            }
        }

        // ä¿®æ”¹åˆ›å»ºç¤¼èŠ±æ•ˆæœå‡½æ•°ï¼Œåªæ’­æ”¾ä¸€æ¬¡
        function createConfetti() {
            const colors = ['#FF6B6B', '#4ECDC4', '#FFD93D', '#95E1D3', '#A78BFA', '#FF9F43'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 1 + 's';
                document.body.appendChild(confetti);
                
                // åŠ¨ç”»ç»“æŸåç§»é™¤ç¤¼èŠ±
                confetti.addEventListener('animationend', () => {
                    confetti.remove();
                }, { once: true }); // ç¡®ä¿äº‹ä»¶ç›‘å¬å™¨åªè§¦å‘ä¸€æ¬¡
            }
        }

        // ä¿®æ”¹æ’è¡Œæ¦œè®°å½•å‡½æ•°ï¼Œæ·»åŠ ç”¨æ—¶è®°å½•
        function updateLeaderboard(gameScore) {
            const playerScore = calculatePlayerScore(gameScore, timeLeft, currentLevel);
            let leaderboard = JSON.parse(localStorage.getItem('playerLeaderboard')) || [];
            
            // æ·»åŠ æ–°çš„è®°å½•
            const newRecord = {
                score: playerScore,
                gameScore: gameScore,
                time: 120 - timeLeft,
                date: new Date().toISOString(),
                level: currentLevel,
                playerName: localStorage.getItem('playerName') || 'ç©å®¶' + Math.floor(Math.random() * 10000),
                avatar: localStorage.getItem('playerAvatar') || 'https://s1.imagehub.cc/images/2024/02/23/default_avatar.jpeg'
            };
            
            leaderboard.push(newRecord);
            
            // æŒ‰ç§¯åˆ†é™åºå’Œç”¨æ—¶å‡åºæ’åº
            leaderboard.sort((a, b) => {
                if (b.score !== a.score) {
                    return b.score - a.score;
                }
                return a.time - b.time;
            });
            
            // åªä¿ç•™å‰10å
            leaderboard = leaderboard.slice(0, 10);
            
            // ä¿å­˜æ’è¡Œæ¦œ
            localStorage.setItem('playerLeaderboard', JSON.stringify(leaderboard));
            return playerScore;
        }

        // ä¿®æ”¹è·å–æ’è¡Œæ¦œHTMLçš„å‡½æ•°
        function getLeaderboardHTML() {
            const leaderboard = JSON.parse(localStorage.getItem('playerLeaderboard')) || [];
            
            if (leaderboard.length === 0) {
                return '<div class="no-records">æš‚æ— æ’è¡Œè®°å½•</div>';
            }
            
            return `
                <div class="leaderboard-title">æœ€ä½³è®°å½•</div>
                <div class="leaderboard-list">
                    ${leaderboard.map((record, index) => `
                        <div class="leaderboard-item ${index < 3 ? 'top-' + (index + 1) : ''}">
                            <div class="rank">${index + 1}</div>
                            <div class="score">${record.score}åˆ†</div>
                            <div class="time">ç”¨æ—¶: ${formatTime(record.time)}ç§’</div>
                            <div class="level">ç¬¬${record.level}å…³</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // æ·»åŠ æ—¶é—´æ ¼å¼åŒ–å‡½æ•°
        function formatTime(seconds) {
            return seconds.toFixed(1);
        }

        // ä¿®æ”¹å¼¹çª—å‡½æ•°ï¼Œä½¿å…¶åœ¨å±å¹•ä¸­é—´æ˜¾ç¤º
        function showSweetAlert(message, icon) {
            // ç§»é™¤å·²å­˜åœ¨çš„å¼¹çª—
            const existingAlert = document.querySelector('.sweet-alert');
            const existingBackdrop = document.querySelector('.sweet-alert-backdrop');
            if (existingAlert) existingAlert.remove();
            if (existingBackdrop) existingBackdrop.remove();

            // åˆ›å»ºèƒŒæ™¯é®ç½©
            const backdrop = document.createElement('div');
            backdrop.className = 'sweet-alert-backdrop';
            document.body.appendChild(backdrop);

            // åˆ›å»ºå¼¹çª—
            const alert = document.createElement('div');
            alert.className = 'sweet-alert';
            alert.innerHTML = `
                <div class="sweet-alert-icon">${icon}</div>
                <div class="sweet-alert-title">${message}</div>
                <button class="sweet-alert-button" onclick="this.closest('.sweet-alert').remove(); document.querySelector('.sweet-alert-backdrop').remove();">ç¡®å®š</button>
            `;

            document.body.appendChild(alert);

            // 3ç§’åè‡ªåŠ¨å…³é—­
            setTimeout(() => {
                alert.remove();
                backdrop.remove();
            }, 3000);
        }

        // ä¿®æ”¹ç©å®¶ç§¯åˆ†è®¡ç®—å‡½æ•°
        function calculatePlayerScore(gameScore, timeLeft, level) {
            // åŸºç¡€åˆ†æ•°ï¼ˆæ ¹æ®å…³å¡é€’å¢ï¼‰
            let baseScore = 10 * level; // ç¬¬ä¸€å…³10åˆ†èµ·æ­¥ï¼Œæ¯å…³é€’å¢10åˆ†
            
            // æ¸¸æˆåˆ†æ•°å¥–åŠ±ï¼ˆæ¸¸æˆåˆ†æ•°é™¤ä»¥100ä½œä¸ºå¥–åŠ±ï¼‰
            let gameScoreBonus = Math.floor(gameScore / 100);
            
            // æ—¶é—´å¥–åŠ±ï¼ˆæ¯å‰©ä½™1ç§’å¢åŠ 1åˆ†ï¼‰
            const timeBonus = Math.floor(timeLeft);
            
            // å…³å¡åŠ æˆï¼ˆæ¯å…³å›ºå®šåŠ æˆï¼‰
            const levelBonus = level * 50; // æ¯å…³å¢åŠ 50åˆ†çš„å›ºå®šåŠ æˆ
            
            // å®Œç¾é€šå…³å¥–åŠ±ï¼ˆå¦‚æœåˆ†æ•°è¶…è¿‡ç›®æ ‡åˆ†æ•°çš„150%ï¼Œç»™äºˆé¢å¤–å¥–åŠ±ï¼‰
            const targetScore = levelConfig[level].target;
            const perfectBonus = gameScore > targetScore * 1.5 ? 100 : 0; // å®Œç¾é€šå…³å¥–åŠ±100åˆ†
            
            // è®¡ç®—æ€»ç§¯åˆ†
            const totalScore = baseScore + gameScoreBonus + timeBonus + levelBonus + perfectBonus;
            
            // è¿”å›ç§¯åˆ†æ˜ç»†ï¼Œç”¨äºæ˜¾ç¤º
            return {
                total: totalScore,
                details: {
                    baseScore: baseScore,
                    gameScoreBonus: gameScoreBonus,
                    timeBonus: timeBonus,
                    levelBonus: levelBonus,
                    perfectBonus: perfectBonus
                }
            };
        }
    </script>
</body>
</html> 